<div ng-controller="ObservationController">
	<div ng-if="observation._id">

		<!-- Placeholders for status stuff -->
		<!-- Watchers - am I watching, click to show who's watching -->
		<span class="pull-right"><watchers observation="observation"></watchers></span>

		<!-- Workflows, show current status. Click dropdown show actions -->
		<span class="pull-right"><workflow observation-changes="observationChanges" observation="observation"></workflow>&nbsp;</span>
<!-- 		<span class="pull-right"><workingcomments observation="observation"></workingcomments>&nbsp;</span> -->

		<h1>OBS #{{observation.id}}</h1>

		<!-- Row with tags -->
		<!-- A label showing type of observation -->
		<span class="pull-left"> <span class="label label-default">{{observation.when | date:'yyyy-MM-dd HH:mm'}}</span> 
		<span class="label"	ng-class="{sharing:'label-success', unsafe_act:'label-default', near_miss:'label-info', incident:'label-warning', accident:'label-danger'}[observation.type]" class="label">
				{{observationTypesArray[observation.type]}}</span> &nbsp;
		</span>

		<!-- Just show which version, click to show all versions? -->
		<span class="pull-left"><span class="label label-default">Versjon {{observation._version}}</span>&nbsp;</span> <span class="pull-left"> <span class="label label-default"><resolveclub
					clubid="observation.club"></resolveclub></span>&nbsp;
		</span> <span class="pull-left"><span class="label label-default">Opprettet: <resolveuser userid="observation.reporter"></resolveuser></span>&nbsp;</span> <span class="pull-left"><span
			class="label label-default">Eier: <resolveuser userid="observation.owner"></resolveuser></span>&nbsp;</span>

		<!-- If changes, show warning include a "leaving page are you sure?"  -->
		<span ng-if="observationChanges" class="pull-left"><span ng-click="saveObservation()" class="label label-danger">{{observationChanges ? 'Endringer' : 'Lagret'}}</span>&nbsp;</span>



		<!-- And replicate the tags here!
		<div ng-repeat="tag in observation.tags">
			<span class="pull-left"><span class="label label-default">{{tag}}</span>&nbsp;</span>
		</div>
		-->

		<div class="clearfix"></div>
		
		<br />



		<!-- EDITABLE -->

		<!-- LISTBOX -->
		<div class="list-group" style="padding: 50px -15px; margin-left: -15px; margin-right: -15px;">

			<li class="list-group-item">
				<p class="list-group-item-text">
				<div class="col-xs-12  col-md-12">
				<label class="control-label">Tittel</label>
				<tagging model="observation.tags" group="observation" noun="ord"></tagging>

				</div>
				</p>
				<div class="clearfix"></div>
			</li>


			<li class="list-group-item">
				<p class="list-group-item-text">
				<div class="col-xs-12 col-md-4">
				<div class="form-group">
						<label class="control-label">Observasjons tidspunkt:</label><br />
					<observationdateselector observation="observation"></observationdateselector>
					</div>
				</div>

				<div class="col-xs-12 col-md-3 col-md-offset-1">
						<observationtype observation="observation"></observationtype>
				</div> 
				<!-- Ratings -->
				<div class="col-xs-12 col-md-4">

					<div class="form-group">
						<label class="control-label">Alvorlighetsgrad</label><br />
						<p>
						<rating-actual observation="observation"></rating-actual>
						</p>
						<p>
						<rating-potential observation="observation"></rating-potential>
						</p>
					</div>
				</div>
				</p>
				<div class="clearfix"></div>
			</li>


			<li class="list-group-item">
				<p class="list-group-item-text">
				<div class="row">
					<filepreviews save="saveObservation()" observation="observation"></filepreviews>
				</div>
				<div class="hidden-xs hidden-sm">
					<div ng-file-drop ng-model="files" ng-file-change="upload($files)" class="drop-box" drag-over-class="dragover" ng-multiple="true" allow-dir="true" accept="*">Dra og slipp filer her</div>
					<div ng-no-file-drop>File Drag/Drop is not supported for this browser</div>
				</div>

				<button class="btn btn-block btn-primary" ng-file-select ng-multiple="true" ng-file-change="upload($files)">
					<i class="fa fa-plus fa-fw"></i> Legg til fil
				</button>


				</p>
				<div class="clearfix"></div>
			</li>

			<li class="list-group-item">
				<h4 class="list-group-item-heading">Sted</h4>
				<p class="list-group-item-text">
<!-- 					<a ng-init="isCollapsed=false" ng-click="isCollapsed = !isCollapsed">{{isCollapsed ? 'Vis kart' : 'Lukk kart'}}</a> -->
<!-- 				<div collapse="isCollapsed"> -->

<!-- 					<location-summary observation="observation"></location-summary> -->
<!-- 				</div> <locationselector observation="observation"></locationselector> -->
				<div ng-if="observation.location.geo.coordinates">
				<map center="{{observation.location.geo.coordinates}}">
				  <marker
				      position="{{observation.location.geo.coordinates}}"
				      title="{{observation.location.name}}"
				      draggable="false"
				      visible="true"
				      ></marker>
				</map>
				</div>
				<location observation="observation"></location>
				</p>
				<div class="clearfix"></div>
			</li>

			<li class="list-group-item">
				<h4 class="list-group-item-heading">Hoppfeltorganisasjon</h4>
				<p class="list-group-item-text">
					<organization-summary observation="observation"></organization-summary>
					<organization observation="observation"></organization>
				</p>
				<div class="clearfix"></div>
			</li>

			<li class="list-group-item">
				<h4 class="list-group-item-heading">Involverte</h4>
				<p class="list-group-item-text">
					<involved-summary observation="observation"></involved-summary>
					<involvedpersonselector observation="observation"></involvedpersonselector>
				</p>
				<div class="clearfix"></div>
			</li>

			<li class="list-group-item">
				<h4 class="list-group-item-heading">Forløp</h4>
				<p class="list-group-item-text">
					<observation-components-summary observation="observation"></observation-components-summary>
					<observation-components observation="observation"></observation-components>
				</p>
				<div class="clearfix"></div>
			</li>

			<!-- Weather; should be more intelligent and using weather icons? -->
			<li class="list-group-item">
				<h4 class="list-group-item-heading">Været</h4>
				<p class="list-group-item-text">
				<span ng-show="observation.weather.manual.wind.max"><span class="label label-default">Max {{observation.weather.manual.wind.max}} knop </span>&nbsp;</span>
				<span ng-show="observation.weather.manual.wind.avg"><span class="label label-default">Avg {{observation.weather.manual.wind.avg}} knop </span>&nbsp;</span>
				<span ng-show="observation.weather.manual.wind.gusting"><span class="label label-warning">Gusting</span>&nbsp;</span>
				<span ng-show="observation.weather.manual.wind.turbulence"><span class="label label-warning">Turbulent</span>&nbsp;</span>
				<span ng-show="observation.weather.manual.wind.dir"><span class="label label-default">{{observation.weather.manual.wind.dir}}</span>&nbsp;</span>
				
				<div class="clearfix"></div><br />
				<p>{{observation.weather.manual.description}}</p>
				<div class="clearfix"></div>
					
					<weather observation="observation"></weather>
				</p>
				<div class="clearfix"></div>
			</li>

			<!-- Actions! -->
			<li class="list-group-item">
				<h4 class="list-group-item-heading">Tiltak</h4>
				<p class="list-group-item-text">
					<div class="col-xs-12 col-md-6">
						<strong>Lokale:</strong>
						<ol>
							<li ng-repeat="a in observation.actions.local">{{a}}</li>
						</ol>
					</div>
					<div class="col-xs-12 col-md-6">
						<strong>Sentrale:</strong>
						<ol>
							<li ng-repeat="a in observation.actions.central">
								{{a}}
							</li>
						</ol>
					</div>
					<div class="clearfix"></div>
					<actions observation="observation"></actions>
				</p>
				<div class="clearfix"></div>
			</li>
			<!-- 
			<li class="list-group-item">
				<h4 class="list-group-item-heading">Relaterte</h4>
				<p class="list-group-item-text"></p>
				<div class="clearfix"></div>
			</li>
			 -->
			 
			<li class="list-group-item">
				<h4 class="list-group-item-heading">Datamodell</h4>
				<p class="list-group-item-text">
					<summary observation="observation"></summary>
				</p>
				<div class="clearfix"></div>
			</li>

		</div>
		<!-- END LISTBOX -->

		<!-- Ng if has edited stuff to be saved or not -->
		<button ng-disabled="!observationChanges" class="btn btn-primary btn-block" ng-click="saveObservation()">
			<i class="fa fa-save fa-fw"></i> Lagre
		</button>

	</div>
</div>
</div>